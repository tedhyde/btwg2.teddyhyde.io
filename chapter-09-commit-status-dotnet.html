<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>.NET and the Commit Status API</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-auth.js"></script>
<script src="https://cdn.teddyhyde.com/0.0.1/teddyhyde-client-0.0.1.js"></script>
<script src="edit.js"></script>
<link rel="stylesheet" type="text/css" href="fab.css">
<link rel="stylesheet" type="text/css" href="micromodal.css">
<link rel="stylesheet" type="text/css" href="https://cdn.teddyhyde.com/0.0.1/teddyhyde-reveal-jekyll.css" />
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-1.8.2.min.js"></script>
<!-- Include jQuery Popup Overlay -->
<script src="https://cdn.rawgit.com/vast-engineering/jquery-popup-overlay/1.7.13/jquery.popupoverlay.js"></script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="commit_status">.NET and the Commit Status API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the risk of oversimplifying things too much, one way to look at a Git repository is as just a long series of commits.
Each commit contains quite a bit of information: the contents of the source files, who created the commit and when, the author&#8217;s comments on what changes the commit introduces, and so on.
This is all good stuff, and works very well for Git&#8217;s main use case: controlling the history of a software project.</p>
</div>
<div class="paragraph">
<p>GitHub&#8217;s Commit Status API adds another layer of metadata to a commit: what various services <em>say</em> about that commit.
This capability primarily shows itself in the pull request UI, as shown in <a href="#status_pr">Commit status in the pull request UI</a>.
Each commit in the pull request is annotated with a symbol indicating its status&#x2014;a red "&#xd7;" for failure or error, a green "&#x2713;" for success, or an amber "&#x2022;" to indicate that a decision is in the process of being made.
This feature also surfaces at the bottom of the pull request; if the last commit in the branch is not marked as successful, you get a warning about merging the request.</p>
</div>
<div id="status_pr" class="imageblock">
<div class="content">
<img src="images/btwg_0501.png" alt="btwg 0501">
</div>
<div class="title">Figure 1. Commit status in the pull request UI</div>
</div>
<div class="paragraph">
<p>The most obvious application for this feature is a continuous-integration service.
A program like Jenkins will get a notification when new commits are pushed to a branch, run a build/test cycle using the new code, and post the results through the Commit Status API.
An application like this can even include a link back to the build results, so the user can find out which tests failed.
This is a great way to bring together everything needed to make a decision about a proposal: what code has changed, what do people think about it, and does this change break anything?
The answer to all of these questions is available on the same page: the pull-request conversation view.</p>
</div>
<div class="paragraph">
<p>But building and testing is only the beginning; the status of a commit can be used for other purposes as well.
For example, open source projects often have a license agreement you must sign in order to submit a contribution.
These are called "contributor license agreements," and usually contain language about licensing the contribution to the maintainers of the project.
But it&#8217;s tedious to manually check every incoming pull request to see if the author has signed the CLA, so a continuous-integration-style service can be used for this.
CLAHub is one such example: it checks to see if all of the authors of the contained commits have signed the CLA, and marks the latest commit as "error" if not.</p>
</div>
<div class="paragraph">
<p>So now that we know what the feature is, and what its intended use is, let&#8217;s take a look at how a program can interact with it.</p>
</div>
<div class="sect2">
<h3 id="_the_api">The API</h3>
<div class="paragraph">
<p>First, let&#8217;s talk about access control.
The Commit Status API exposes the need for OAuth as few others do.
Making a repository private means you want complete control of what people or applications can access it.
Naturally you trust GitHub&#8217;s internal code to do the right thing with your data, but what about some random application from the Internet?
OAuth gives you a way to grant private-repository access to an application <em>with limits</em>&#x2014;the use of OAuth scopes allows an application to ask for a specific set of permissions, but it won&#8217;t be able to do just any old thing with your data.
Plus, this way you&#8217;re always in control of these permissions; you can revoke an application&#8217;s access at any time.</p>
</div>
<div class="paragraph">
<p>The OAuth system includes the concept of scopes, which can be requested by and granted to an application, each of which allows a certain set of actions.
The Commit Status API requires the <code>repo:status</code> OAuth scope, which allows an application read and write access to <em>just</em> commit statuses; there is no access granted to the actual contents of the repository.
This might seem strange: how can you judge the status of a commit without being able to inspect its contents?
Just remember that this feature has use cases beyond continuous integration, and an application may not need full access to make a decision.
For services that do need to be able to look at the repository contents, you can request the <code>repo</code> scope, which grants read <em>and</em> write access to the entire contents of a repository, including commit statuses.
As of this writing, there&#8217;s no way to request read-only access to repositories, so if a service needs access to your data, you have to trust it with write access.</p>
</div>
<div class="paragraph">
<p>You can also use this API in anonymous mode, without using OAuth at all.
However, in that case you&#8217;re limited to reading statuses from public repositories; there is no writing, and private repositories are off-limits.</p>
</div>
<div class="paragraph">
<p>Just to summarize:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OAuth scope</th>
<th class="tableblock halign-left valign-top">Access to statuses</th>
<th class="tableblock halign-left valign-top">Access to repo data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None (anonymous)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read-only on public repos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read-only on public repos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo:status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read/write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read/write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read/write</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_raw_statuses">Raw Statuses</h4>
<div class="paragraph">
<p>Now that we know how we get access to commit statuses, let&#8217;s see what they look like.
Commit statuses exist as atomic entities, and each commit can have a practically unlimited number of them (the actual number is in the thousands).
You can query for existing statuses by doing a GET request to the API server at <code>/repos/<em>&#x3c;user&#x3e;</em>/<em>&#x3c;repo&#x3e;</em>/<em>&#x3c;ref&#x3e;</em>/statuses</code>, and it will return a list of them that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "url": "https://api.github.com/repos/…",
    "id": 224503786,
    "state": "success",
    "description": "The Travis CI build passed",
    "target_url": "https://travis-ci.org/libgit2/libgit2/builds/63428108",
    "context": "continuous-integration/travis-ci/push",
    "created_at": "2015-05-21T03:11:02Z",
    "updated_at": "2015-05-21T03:11:02Z"
  },
  …
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of this is self-explanatory, but a couple of fields need explaining:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>success</code>, <code>failure</code>, <code>error</code>, or <code>pending</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A URL for the specific decision made for this commit (in this case a build/test log), which helps the user figure out why a particular decision was reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for correlating multiple status updates to a single service; each application sets this according to its own rules, but any process that creates statuses should post the <code>pending</code> status and the result status using the same context value.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This API is useful for getting the raw data involved, but it gets complicated quickly.
How do you decide if a given commit is "good?"
What if there are three pending statuses, one success, another pending, two failures, and another success, in that order?
The <code>context</code> field can help you correlate a single service&#8217;s updates, and you can order them by <code>created_at</code> to see how each one turned out, but that&#8217;s a lot of work.
Fortunately, the API server can do it for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_combined_status">Combined Status</h4>
<div class="paragraph">
<p>If you instead do a GET to <code>/repos/<em>&#x3c;user&#x3e;</em>/<em>&#x3c;repo&#x3e;</em>/<em>&#x3c;ref&#x3e;</em>/status</code> (note that the last word is singular), you&#8217;ll instead get a response that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "state": "success",
  "statuses": [
    {
      "url": "https://api.github.com/repos/…",
      …
    },
    { … }
  ],
  "sha": "6675aaba883952a1c1b28390866301ee5c281d37",
  "total_count": 2,
  "repository": { … },
  "commit_url": "https://api.github.com/repos/…",
  "url": "https://api.github.com/repos/…"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>statuses</code> array is the result of the logic you&#8217;d probably write if you had to: it collapses the statuses by context, keeping only the last one.
The <code>state</code> field contains an overall status that takes into account all of the contexts, providing a final value based on these rules:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Cause</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>failure</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any of the contexts posted a <code>failure</code> or <code>error</code> state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>pending</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any of the contexts' latest state is <code>pending</code>, or there are no statuses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>success</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest status for every context is <code>success</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This is probably exactly what you want, but if you find that your use case calls for different rules, you can always use the <code>statuses</code> endpoint to get the raw data and calculate your own combined status.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_status">Creating a Status</h4>
<div class="paragraph">
<p>Now obviously these statuses have to come from somewhere.
This API also includes a facility for creating them.
To do this, you simply make a POST request to <code>/repos/<em>&#x3c;user&#x3e;</em>/<em>&#x3c;repo&#x3e;</em>/statuses/<em>&#x3c;sha&#x3e;</em></code>, and supply a JSON object for the fields you want to include with your status:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>state</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be one of <code>pending</code>, <code>success</code>, <code>error</code>, or <code>failure</code> (required).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>target_url</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A link to detailed information on the process of deciding what the state is or will be.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>description</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A short string describing what the service is doing to make a decision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>context</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An application-specific string to allow the API to manage multiple services contributing to a single commit&#8217;s status.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Notice how the last component in that URL is <code><em>&#x3c;sha&#x3e;</em></code>.
While you can query for statuses or a combined status using a ref name (like <code>master</code>), creating a status requires you to know the full SHA-1 hash of the commit you want to annotate.
This is to avoid race conditions: if you were targeting a ref, it may have moved between when your process started and when it finished, but the SHA of a commit will never change.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_let_s_write_an_app">Let&#8217;s Write an App</h3>
<div class="paragraph">
<p>Alright, now that we know how to read and write statuses, let&#8217;s put this API to work.
In this chapter, we&#8217;ll build a simple HTTP service that lets you create commit statuses for repositories you have access to using the OAuth web flow for authorization.
The system we&#8217;ll build will be fairly limited in scope, but it&#8217;s a great starting point to customize for your specific needs.</p>
</div>
<div class="paragraph">
<p>The language this time is C#, running on the CLR (Common Language Runtime).
At one point in the history of computing this wouldn&#8217;t have been a good choice for a book like this, since it was only available on Windows, the development tools cost quite a bit of money, and the language and libraries were fairly limited.
However, with the advent of Mono (an open source implementation of the .NET runtime), the open sourcing of the CLR core, and the availability of free tools, C# is now a completely valid and rather nice option for open source or hobby developers.
Plus, it has a vibrant ecosystem of packages we can leverage to make our jobs easier.</p>
</div>
<div class="sect3">
<h4 id="_libraries">Libraries</h4>
<div class="paragraph">
<p>You&#8217;ll be happy to know we won&#8217;t be writing an entire HTTP server from scratch in this chapter.
There are a number of open source packages that do this work for us, and in this project we&#8217;ll be using Nancy.
Nancy is a project that started as a CLR port of the Sinatra framework for Ruby (it takes its name from Frank Sinatra&#8217;s daughter, Nancy).
It&#8217;s very capable, but also very succinct, as you&#8217;ll see.</p>
</div>
<div class="paragraph">
<p>We also won&#8217;t be directly implementing access to the GitHub API, because GitHub provides a CLR library for that.
It&#8217;s called octokit.net, and it does all the right things with regard to asynchrony and type safety.
This is the same library used by the GitHub client for Windows, so it&#8217;ll definitely do the job for our little application.
It is, however, the source of a constraint on how we set up our example project: it requires a rather new version of the CLR (4.5) in order to function.
If you want some guidance on how to avoid this pitfall and follow along, continue reading the next section.
If you&#8217;ve worked with Nancy before, and have installed NuGet packages in the past, you might be able to skip to the section labeled <a href="#commit_status_first_steps">Sending the Request</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_development_environment">Development Environment</h4>
<div class="paragraph">
<p>If you&#8217;d like to follow along with the code examples, here&#8217;s how to set up a development environment with all the necessary elements.
The process is different on Windows (using Visual Studio) and any other platforms (using Xamarin tools).</p>
</div>
<div class="sect4">
<h5 id="_visual_studio">Visual Studio</h5>
<div class="paragraph">
<p>If you&#8217;re running Windows, you&#8217;ll want to visit <a href="https://www.visualstudio.com/" class="bare">https://www.visualstudio.com/</a> and download the Community edition of Visual Studio.
The installer will present you with lots of options; for this example, we&#8217;ll only need the "web developer" components, but feel free to check all the boxes that look interesting to you.
(If you have access to a higher tier of Visual Studio, or already have it installed with the web-development packages, you&#8217;re all set.)</p>
</div>
<div class="paragraph">
<p>In order to make things just a little smoother, you&#8217;ll want to install a plug-in: the Nancy project templates.
Visit <a href="https://visualstudiogallery.msdn.microsoft.com/" class="bare">https://visualstudiogallery.msdn.microsoft.com/</a> and search for "nancy.templates."
Choose the search result "Nancy.Templates," which belongs to the NancyFx organization, and click "Get Now."
This should download a <em>.vsix</em> file that you can double-click to install the templates into Visual Studio.</p>
</div>
<div class="paragraph">
<p>The next step is to create a new project using one of the newly installed templates.
Go to &#x201c;File&#8594;New Project&#x201d; and select &#x201c;Visual C#&#8594;Web&#8594;Nancy Application with ASP.NET Hosting&#x201d; from the template list (as shown in <a href="#vs_new_project">Creating a Nancy application in Visual Studio</a>).
Make sure the path and name settings at the bottom are to your liking, and click OK.</p>
</div>
<div id="vs_new_project" class="imageblock">
<div class="content">
<img src="images/btwg_0502.png" alt="btwg 0502">
</div>
<div class="title">Figure 2. Creating a Nancy application in Visual Studio</div>
</div>
<div class="paragraph">
<p>Next, change the target CLR framework version to something that will work with Octokit.
Right-click the project&#8217;s node in the Solution Explorer, and select &#x201c;Properties.&#x201d;
In the Application section, set Target Framework to be .NET 4.5 (or later), and save.
You may be prompted to reload the solution.</p>
</div>
<div class="paragraph">
<p>The very last step is to add NuGet packages for Octokit and Nancy.
Right-click the project node in Solution Explorer, and select &#x201c;Manage NuGet Packages.&#x201d;
Do a search for "Nancy," and upgrade it if necessary&#x2014;there&#8217;s a chance the Nancy project template specifies an out-of-date version.
Then do a search for "Octokit," and install that.
At this point, you should have an empty solution, configured and ready for our example code.
To run it with debugging, go to &#x201c;Debug&#8594;Start Debugging,&#x201d; or hit F5.
Visual Studio will start the server under a debugger, and open an IE instance on <a href="http://localhost:12008/" class="bare">http://localhost:12008/</a> (the port might be different), which should serve you the default Nancy "404 Not Found" page.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xamarin_studio">Xamarin Studio</h5>
<div class="paragraph">
<p>On OS X and Linux, as of this writing the easiest way forward is to visit <a href="http://www.monodevelop.com/" class="bare">http://www.monodevelop.com/</a> and install MonoDevelop.
Mono is an open source implementation of Microsoft&#8217;s CLR specification, and MonoDevelop is a development environment that works much like Visual Studio, but is built on Mono, and is completely open source.
If you try to download MonoDevelop on a Windows or OS X machine, you&#8217;ll be prompted to install Xamarin Studio instead; this is a newer version of MonoDevelop with more capabilities, and will work just as well for these examples.</p>
</div>
<div class="paragraph">
<p>There are no Nancy-specific project templates for these IDEs, so you&#8217;ll just start with an empty web project.
Go to "File&#8594;New&#8594;Solution," and choose "ASP.NET&#8594;Empty ASP.NET Project" from the template chooser, as shown in <a href="#xamarin_new_project">Creating an empty ASP.NET application in Xamarin Studio</a>.</p>
</div>
<div id="xamarin_new_project" class="imageblock">
<div class="content">
<img src="images/btwg_0503.png" alt="btwg 0503">
</div>
<div class="title">Figure 3. Creating an empty ASP.NET application in Xamarin Studio</div>
</div>
<div class="paragraph">
<p>The rest of the wizard steps are about the project name and location; feel free to name and locate this project however you like.</p>
</div>
<div class="paragraph">
<p>Next, update the target framework setting.
Control- or right-click the node in the solution explorer that corresponds with your project (<em>not</em> your solution), and select Options from the menu.
Under &#x201c;Build&#8594;General,&#x201d; set the Target Framework to &#x201c;Mono / .NET 4.5&#x201d; (or later) and click OK.</p>
</div>
<div class="paragraph">
<p>Lastly, install the Nancy and Octokit NuGet packages.
Go to &#x201c;Project&#8594;Add NuGet Packages&#x201d; in the menu to open the package manager.
Search for Nancy, check the box next to it, search for Octokit, check its box, and click &#x201c;Add Packages&#x201d; at the bottom right.
Once the process is complete, your project is ready for our example code.
To run it under the debugger, go to &#x201c;Run&#8594;Start Debugging,&#x201d; or type ⌘-Enter.
Xamarin will start the server and open a browser window to <a href="http://127.0.0.1:80080" class="bare">http://127.0.0.1:80080</a> (possibly with a different port), which at this point will just show the default "404 Not Found" page.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="commit_status_first_steps">Sending the Request</h4>
<div class="paragraph">
<p>Alright, now that we have a project ready for some code, let&#8217;s get our Nancy application up and running.
Let&#8217;s be good engineers, and write our tests first.
In order to do this, generate a new unit-test project alongside your existing application project, and add a NuGet reference to the <code>Nancy.Testing</code> package.
You can then copy and paste the test examples over the top of the default test module that comes with that template.</p>
</div>
<div class="paragraph">
<p>The first thing we&#8217;re going to write is an endpoint that reports how many followers a user has.
In order to test it, we&#8217;ll choose a well-known user and make sure their real name is fetched.
Here&#8217;s what the test code looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using NUnit.Framework;
using Nancy;
using Nancy.Testing;
using Nancy.Bootstrapper;
using System.Collections.Generic;
using Nancy.Session;

namespace NancyApplication1.Tests
{
  [TestFixture ()]
  public class Test
  {
    private Browser browser;

    [SetUp]
    public void Setup(){
      this.bootstrapper =
        new ConfigurableBootstrapper(with =&gt; {
        with.Module&lt;Handler&gt;();
      });
      this.browser = new Browser (bootstrapper);
    }

    [Test ()]
    public void FetchesUserDetails ()
    {
      var result = this.browser.Get ("/mojombo", <b class="conum">(1)</b>
        with =&gt; with.HttpRequest ());
      Assert.AreEqual (HttpStatusCode.OK, result.StatusCode);
      Assert.IsTrue (result.Body.AsString()
        .Contains("Tom Preston-Werner")); <b class="conum">(2)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here we&#8217;re using the <code>Browser</code> class provided by Nancy.Testing to make a request to <code>/mojombo</code>, which should give us the number of likes for that GitHub user.</p>
</li>
<li>
<p>Here we&#8217;re asserting that mojombo&#8217;s real name is fetched by the endpoint.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now that we have a failing test, let&#8217;s write the code to implement that endpoint in Nancy.
Here&#8217;s what the initial version of that file will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Nancy;
using Octokit;
using System;
using System.Collections.Generic;
using System.Linq;

namespace NancyApp
{
    public class Handler : NancyModule <b class="conum">(1)</b>
    {
        private readonly GitHubClient client =
            new GitHubClient(new ProductHeaderValue("MyHello")); <b class="conum">(2)</b>

        public Handler()
        {
            Get["/{user}", true] = async (parms, ct) =&gt; <b class="conum">(3)</b>
                {
                    var user = await client.User.Get(parms.user.ToString()); <b class="conum">(4)</b>
                    return String.Format("{0} people love {1}!",
                                         user.Followers, user.Name); <b class="conum">(5)</b>
                };
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here we derive a class from <code>NancyModule</code>, which is all you have to do to start receiving and processing HTTP requests in Nancy.</p>
</li>
<li>
<p>The <code>GitHubClient</code> class is the entry point for Octokit.
Here we create an instance we&#8217;ll use later on, using a placeholder product name&#x2014;this name will not be used for the APIs we&#8217;ll be accessing.</p>
</li>
<li>
<p>The module&#8217;s constructor needs to set up route mappings.
We map <code>/{user}</code> to a lambda function using the <code>Get</code> dictionary that comes with <code>NancyModule</code>.
The second parameter to the index operator says that the handler will be asynchronous.</p>
</li>
<li>
<p>Here we see how to get the <code>{user}</code> part of the request URL (it comes as a property on the <code>parms</code> parameter), and how to query the GitHub User API using Octokit.
Note that we have to <code>await</code> the result of the network query, since it may take some time.</p>
</li>
<li>
<p>Nancy request handlers can simply return a text string, which will be marked as HTML for the viewing browser.
Here we return a simple string with the user&#8217;s name and number of followers.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>async</code> and <code>await</code> keywords bear special mention.
These comprise a syntactic nicety that encapsulates a series of functions that are running on an event loop.
The code looks like it runs in order, but really when the <code>await</code> keyword is reached, the system starts an asynchronous request, and returns control back to the main event loop.
Once the request has finished, and the promise is fulfilled, the event loop will then call back into the code that&#8217;s expecting the return value of the <code>await</code> keyword, with all the scope variables intact.
This feature was introduced in .NET 4.0 (which was released in 2012), and it lets you write asynchronous code almost as though it were synchronous.
This is but one of the features that make C# the favorite of many developers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example is a bit more complicated than "hello, world," but it&#8217;s still fairly succinct and clear.
This bodes well, because we&#8217;re about to introduce some complexity, in the form of OAuth.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oauth_flow">OAuth Flow</h4>
<div class="paragraph">
<p>In order to post a status update for a commit, we&#8217;re going to have to ask the user for permission.
Apart from asking for their username and password (which gives way too much control, and if two-factor authentication is enabled may not even be enough), the only way to do this is OAuth, which isn&#8217;t entirely straightforward.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple outline of the OAuth process, from our little server&#8217;s point of view:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We need an authorization token, either because we don&#8217;t have one, or because the one we have is expired.
This is just a string of characters, but we can&#8217;t generate it ourselves, so we ask GitHub for one.
This involves redirecting the user&#8217;s browser to a GitHub API endpoint, with the kind of permission we&#8217;re asking for and some other details as query parameters.</p>
</li>
<li>
<p>GitHub tells the user (through their browser) that an application is requesting some permissions, and they can either allow or deny them.</p>
</li>
<li>
<p>If the user allows this access, their browser is redirected to a URL we specified in step 1.
A "code" is passed as a query parameter; this is not the access token we want, but a time-limited key to get one.</p>
</li>
<li>
<p>From inside the handler for this request, we can use a REST API to get the actual OAuth access token, which we can store somewhere safe.
We do this because if we already have a token, we can skip all the way to the last step of this process.</p>
</li>
<li>
<p>Now we have permission, and we can use the GitHub API in authenticated mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This might seem overly complicated, but its design achieves several goals.
First, permission can be scoped&#x2014;an application is almost never given full access to the user&#8217;s account and data.
Second, the whole exchange is secure; at least one part of this has to go through the user, and cannot be automated.
Third, the access token is never transmitted to the user&#8217;s browser, which avoids an entire class of security vulnerabilities.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s walk through the code for our tiny little server&#8217;s implementation of this flow.
First, once we have a token, we should store it so we&#8217;re not going through the entire redirect cycle for every user request.
We&#8217;re going to store it in a cookie (though since this goes back and forth to the user&#8217;s browser, a production application would probably use a database).
Nancy can help us with this, but first we have to enable it, and the way this is accomplished is by using a bootstrapper.
We&#8217;re going to add this class to our application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Nancy;
using Nancy.Bootstrapper;
using Nancy.Session;
using Nancy.TinyIoc;

namespace NancyApp
{
    public class Bootstrapper : DefaultNancyBootstrapper
    {
        protected override void ApplicationStartup(TinyIoCContainer container,
                                                   IPipelines pipelines)
        {
            CookieBasedSessions.Enable(pipelines);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nancy will automatically detect a bootstrapper class, and use it to initialize our server.
Now, from within a <code>NancyModule</code>, we can use the <code>Session</code> property to store and retrieve values that are transmitted as cookies.</p>
</div>
<div class="paragraph">
<p>Next, we have to include our application&#8217;s ID and secret in some of the requests, so we embed them in the code by adding these fields to the <code>Handler</code> class.
If you don&#8217;t have an application, visit <a href="https://github.com/settings/developers" class="bare">https://github.com/settings/developers</a> to create one and use <code><a href="http://localhost:8080/authorize" class="bare">http://localhost:8080/authorize</a></code> (depending in your environment, the port number might be slightly different) for the callback URL&#x2014;we&#8217;ll see why in a bit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">        private const string clientId = "&lt;clientId&gt;";
        private const string clientSecret = "&lt;clientSecret&gt;";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, you should use values from your own API application if you&#8217;re following along.</p>
</div>
<div class="paragraph">
<p>After that, we&#8217;ll need a helper method that kicks off the OAuth process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">private Response RedirectToOAuth()
{
    var csrf = Guid.NewGuid().ToString();
    Session["CSRF:State"] = csrf; <b class="conum">(1)</b>
    Session["OrigUrl"] = this.Request.Path; <b class="conum">(2)</b>

    var request = new OauthLoginRequest(clientId)
        {
            Scopes = { "repo:status" }, <b class="conum">(3)</b>
            State = csrf,
        };
    var oauthLoginUrl = client.Oauth.GetGitHubLoginUrl(request);
    return Response.AsRedirect(oauthLoginUrl.ToString()); <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>CSRF stands for <em>cross-site request forgery</em>.
This is a mechanism by which we can be sure the OAuth request process really did originate from our site.
The GitHub OAuth API will pass this value back to us when the user authorizes access, so we store it in the cookie for later reference.</p>
</li>
<li>
<p>Storing the original URL in the session cookie is a UX feature; once the OAuth process has completed, we want to send the user back to what they were trying to do in the first place.</p>
</li>
<li>
<p><code>repo:status</code> is the permission set we&#8217;re asking for.
Note that we&#8217;re also including our CSRF token in this object; this is so GitHub can give it back to us later for verification.</p>
</li>
<li>
<p>Here we use Octokit to generate the redirect URL, and send the user&#8217;s browser there.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>RedirectToOAuth</code> is a method that can be called from any route handler in our module, if it&#8217;s discovered that the token is missing or invalid.
We&#8217;ll see how it&#8217;s called a bit later, but for now let&#8217;s follow the rest of the OAuth process.</p>
</div>
<div class="paragraph">
<p>In our GitHub application settings, we specified an authorization URL.
In this case, we&#8217;ve specified <code><a href="http://localhost:8080/authorize" class="bare">http://localhost:8080/authorize</a></code>, and that&#8217;s where GitHub will redirect the user&#8217;s browser if they decide to grant our application the permissions it&#8217;s asking for.
Here&#8217;s the handler for that endpoint, which has been inserted into the module constructor:</p>
</div>
<div class="listingblock pagebreak-before">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Get["/authorize", true] = async (parms, ct) =&gt; <b class="conum">(1)</b>
    {
        var csrf = Session["CSRF:State"] as string;
        Session.Delete("CSRF:State");
        if (csrf != Request.Query["state"]) <b class="conum">(2)</b>
        {
            return HttpStatusCode.Unauthorized;
        }

        var queryCode = Request.Query["code"].ToString();
        var tokenReq =  new OauthTokenRequest(clientId, <b class="conum">(3)</b>
                                              clientSecret,
                                              queryCode);
        var token = await client.Oauth.CreateAccessToken(tokenReq);
        Session["accessToken"] = token.AccessToken; <b class="conum">(4)</b>

        var origUrl = Session["OrigUrl"].ToString();
        Session.Delete("OrigUrl");
        return Response.AsRedirect(origUrl); <b class="conum">(5)</b>
    };</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This is how you map paths to handler functions in Nancy.
Any class that derives from <code>NancyModule</code> has an indexable object for every HTTP verb, and you can attach a synchronous or asynchronous handler to any one of them.
There are also ways to include dynamic portions of URLs, which we&#8217;ll see later on.</p>
</li>
<li>
<p>Here we verify the CSRF token we generated before.
If it doesn&#8217;t match, something shady is happening, so we return a 401.</p>
</li>
<li>
<p>This is the REST call that converts our OAuth code to an access token.
In order to verify that this really is our application asking for the token, we pass in both the client ID and secret, as well as the code given to us by GitHub.</p>
</li>
<li>
<p>This is where we store the resulting token in the session cookie.
Again, this wouldn&#8217;t be a good idea for a real application, but for our purposes it&#8217;ll do.</p>
</li>
<li>
<p>Here we redirect the user back to what they were originally trying to do, with as little disruption as possible.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This last endpoint is something we can test, but we&#8217;ll need to be able to handle sessions.
In order to do that, we&#8217;ll add this snippet to our test project&#8217;s namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public static class BootstrapperExtensions
{
  public static void WithSession(this IPipelines pipeline,
                                       IDictionary&lt;string, object&gt; session)
  {
    pipeline.BeforeRequest.AddItemToEndOfPipeline(ctx =&gt;
      {
        ctx.Request.Session = new Session(session);
        return null;
      });
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an <em>extension method</em> that allows us to provide a <code>Session</code> object for a request, something the CSRF handling uses.
Now that that exists, we can add a test method to our test-suite class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">[Test]
public void HandlesAuthorization()
{
  // Mismatched CSRF token
  bootstrapper.WithSession(new Dictionary&lt;string, object&gt; {
    { "CSRF:State", "sometoken" },
  });
  var result = this.browser.Get ("/authorize", (with) =&gt; {
    with.HttpRequest();
    with.Query("state", "someothertoken");
  });
  Assert.AreEqual (HttpStatusCode.Unauthorized, result.StatusCode);

  // Matching CSRF token
  bootstrapper.WithSession(new Dictionary&lt;string, object&gt; {
    { "CSRF:State", "sometoken" },
                { "OrigUrl", "http://success" },
  });
  result = this.browser.Get ("/authorize", (with) =&gt; {
    with.HttpRequest();
    with.Query("state", "sometoken");
  });
  result.ShouldHaveRedirectedTo ("http://success");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first part sets up a mismatched CSRF token; it&#8217;s <code>"sometoken"</code> in the session (which is set before the API call is made), and <code>"someothertoken"</code> in the request (which should be sent from GitHub), so we assert that the status code is 401.
The second part has matching tokens, so we assert that the response is a redirect to the URL we stored in the session.</p>
</div>
<div class="paragraph">
<p>Once all that is done, we&#8217;ve got our token and are able to continue on our merry way.
All our handlers have to do to trigger an OAuth sequence is to call <code>RedirectToOAuth()</code> if it&#8217;s necessary, and we&#8217;ll automatically return the user to where they were when the process completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_status_handler">Status Handler</h4>
<div class="paragraph">
<p>Having gone through all that OAuth business, we should now have a token that grants us permission to create commit statuses.
We&#8217;re going to add this handler to our Nancy module constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Get["/{user}/{repo}/{sha}/{status}", true] = async (parms, ct) =&gt; <b class="conum">(1)</b>
    {
        var accessToken = Session["accessToken"] as string;
        if (string.IsNullOrEmpty(accessToken))
            return RedirectToOAuth(); <b class="conum">(2)</b>
        client.Credentials = new Credentials(accessToken);

        CommitState newState = Enum.Parse(typeof(CommitState), <b class="conum">(3)</b>
                                          parms.status,
                                          true);
        try
        {
            var newStatus = new NewCommitStatus <b class="conum">(4)</b>
            {
                State = newState,
                Context = "example-api-app",
                TargetUrl = new Uri(Request.Url.SiteBase),
            };
            await client.Repository.CommitStatus.Create(parms.user, <b class="conum">(5)</b>
                                                        parms.repo,
                                                        parms.sha,
                                                        newStatus);
        }
        catch (NotFoundException) <b class="conum">(6)</b>
        {
            return HttpStatusCode.NotFound;
        }

        var template = @"Done! Go to &lt;a href=""https://" <b class="conum">(7)</b>
        + @"api.github.com/repos/{0}/{1}/commits/{2}/status"
        + @"""&gt;this API endpiont&lt;/a&gt;";
        return String.Format(template,
                             parms.user, parms.repo, parms.sha);
    };</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the request path for this handler: a GET request to <code>localhost:8080/user/repo/<em>&#x3c;sha&#x3e;</em>/<em>&#x3c;status&#x3e;</em></code> will create a new status.
This is easy to test with the browser, but also makes it easy for web crawlers to unknowingly trigger this API.
For this example it&#8217;s okay, but for a real application you&#8217;d probably want to require this to be a POST request.</p>
</li>
<li>
<p>Here&#8217;s where our OAuth helper comes in.
We redirect through the OAuth flow if the session cookie doesn&#8217;t have an authorization token.
It&#8217;s not shown here, but we&#8217;d also want to do this if we get an authorization exception from any of the Octokit APIs.</p>
</li>
<li>
<p>Here we&#8217;re trying to parse the last segment of the request URL into a member of the <code>CommitState</code> enumeration.
Octokit tries to maintain type safety for all of its APIs, so we can&#8217;t just use the raw string.</p>
</li>
<li>
<p>The <code>NewCommitStatus</code> object encapsulates all the things you can set when creating a new status.
Here we set the state we parsed earlier, a (hopefully) unique context value that identifies our service, and a not-very-useful target URL (which should really go to an explanation of how the result was derived).</p>
</li>
<li>
<p>This is the REST call to create the new status.
It&#8217;s an <code>async</code> method, which means we have to <code>await</code> the result before we can do anything with it.</p>
</li>
<li>
<p>There are a number of exceptions that could be thrown from the API, but the biggest one we want to handle is the <code>NotFoundException</code>, which has been translated from the HTTP 404 status.
Here we translate it back to make for a nice(r) experience for the user.</p>
</li>
<li>
<p>If we succeed, we render a snippet of HTML and return it from our handler.
Nancy sets the response&#8217;s <code>content-type</code> to <code>text/html</code> by default, so the user will get a nice clickable link.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>That&#8217;s it!
If you&#8217;ve typed all this into a project of your own, you should be able to run it under the debugger, or host it in an ASP.NET server, and create commit statuses for your projects by opening URLs in your browser.</p>
</div>
<div class="paragraph">
<p>We noted this a bit earlier, but it bears repeating: this particular example responds to GET requests for ease of testing, but for a real service like this you&#8217;d probably want creation of statuses to use a POST request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>Even if you haven&#8217;t written a lot of code during this chapter, you&#8217;ve learned a lot of concepts.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve seen the Commit Status API, and you&#8217;ve seen how it&#8217;s used by continuous integration software, but you know that it can be used for much more.
You can read and write statuses, and you know how the API server coalesces many statuses into a single pass/fail value, and you also know how to write your own multistatus calculation if the default one doesn&#8217;t meet your needs.
You also know what&#8217;s behind the green checkmarks and red Xs you see in your pull requests.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve learned how the OAuth web flow works, and why it&#8217;s designed the way it is.
OAuth is the key to many other capabilities of the GitHub API, and it&#8217;s the right thing to do with regards to trust and permissions.
This will allow you to write truly world-class GitHub-interfacing applications, whether running on the Web or on a user&#8217;s device.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve gained a passing knowledge of C#, including its package system, at least one IDE, lambda functions, object initializers, and more.
C# really is a nice language, and if you use it for a while, you&#8217;ll probably miss some of its features if you write in anything else.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve seen NuGet, the .NET package manager, and had a peek at the multitudes of packages in this ecosystem.
The capability you have here is astounding; libraries exist for many common activities, and lots of uncommon ones too, so no matter what you need to do, you&#8217;re likely to find a NuGet package to help you do it.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve learned about Nancy, with which you can quickly build any HTTP service, from a REST API to an HTML-based interface, and all with a compact syntax and intuitive object model.
If you&#8217;ve never been exposed to the Sinatra view of the world, this probably makes you think about web servers a bit differently, and if you have, you&#8217;ll have a new appreciation for how this model can be idiomatically implemented.</p>
</div>
<div class="paragraph">
<p>And you&#8217;ve had an introduction to Octokit, a type-safe implementation of a REST API, with built-in asynchrony and OAuth helpers.
This toolkit really does make working with the GitHub API as simple and straightforward as using any .NET library, including the ability to explore it using Intellisense.</p>
</div>
<div class="paragraph">
<p>Now it&#8217;s time to switch back to Ruby.
In our next chapter, we&#8217;ll take a look at Jekyll (which is what really runs GitHub Pages), and how to use it to write a blog.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-10-11 16:21:14 PDT
</div>

<div onclick="openCustomization()" class="fab-customization">☃</div>

<div class="loginWrapper">
  <div style="display: none" class="fab-user">👽</div>
  <div onclick="loginToGithub()" style="display: none" class="informational">Please login to GitHub</div>
</div>

<div class="informationalWrapper" style="display: none">
  <div class="informational smaller">
    Click on any dotted section to provide a comment or suggestion. Click on the edit button to cancel.
  </div>
</div>

<div onclick="toggleEditing()" class="fab">✏️</div>

<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-micromodal-close>
    <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
      <header class="modal__header">
	<h2 class="modal__title" id="modal-1-title">
	  Add a comment or change request
	</h2>
	<button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
      </header>
      <main class="modal__content" id="modal-1-content">
	Add a comment or change to this text
	<p id="selectedText">
	</p>

	<input name="change" type="text" placeholder="Enter your comment or edit request..."/>
      </main>
      <footer class="modal__footer">
	<button onclick="storeIt()" class="modal__btn modal__btn-primary">Store comment</button>
	<button class="modal__btn" data-micromodal-close aria-label="Close this dialog window">Close</button>
      </footer>
    </div>
  </div>
</div>

<div class="modal micromodal-slide" id="modal-2" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-micromodal-close>
    <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-2-title">
      <header class="modal__header">
	<h2 class="modal__title" id="modal-2-title">
	  Customize this book for you.
	</h2>
	<button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
      </header>
      <main class="modal__content" id="modal-2-content">

	FYI: This does not yet work!
	<a target="_new" href="https://goo.gl/forms/8o5NgerENFqgm6vH3">Can you help provide feedback on what you like and want?</a>

	<div  class="customization">
	  <input type="checkbox" name="checkbox" id="checkbox_id" value="value">
	  <label for="checkbox_id">Minimize callouts</label>
	  <div class="explanation">If a chapter contains callouts with code, don't show those.
	    You can display these individually by clicking the summary text when needed.
	  </div>
	</div>

	<div class="customization">
	  <input type="checkbox" name="checkbox" id="checkbox_id2" value="value">
	  <label for="checkbox_id2">Minimize setup instructions</label>
	  <div class="explanation">If a chapter contains setup instructions, don't show those.
	    You can display these individually by clicking the summary text when needed.
	  </div>
	</div>

	<div class="customization">
	  <input type="checkbox" name="checkbox" id="checkbox_id3" value="value">
	  <label for="checkbox_id3">Show quizes</label>
	  <div class="explanation">
	    At certain points in the discussion, present quizes which test your knowledge!
	  </div>
	</div>

	<div class="customization">
	  <input type="checkbox" name="checkbox" id="checkbox_id4" value="value">
	  <label for="checkbox_id4">Show mistakes</label>
	  <div class="explanation">
	    At times the author may have made mistakes in writing the code. You can read about the techniques
	    used to figure out something was wrong, or only see the final solution.
	  </div>
	</div>

      </main>
      <footer class="modal__footer">
	<button  class="modal__btn modal__btn-primary">Save Customizations</button>
	<button class="modal__btn" data-micromodal-close aria-label="Close this dialog window">Close</button>
      </footer>
    </div>
  </div>
</div>

<div id="filedIssue">
  Thanks for your contribution!
  <div id="issueUrl"></div>.
  You've been tagged on it, so you will get updates automatically.
</div>

<iframe height="150px" width="100%"
	style="background-color: white !important"
	frameborder="0" id="th"
	src="https://tx.teddyhyde.com/contribution/btwg2.teddyhyde.io"></iframe>

<div class="faked">NB: This "contribution" button is a only a simulation, no actual money is required.
You can safely click the contribute button to see what would happen if you actually made a micro-contribution.
</div>

<div id="wrapper">
  <div id="personal_ad_wrapper">
    <!-- Add content to the popup -->
    <div id="personal_ad_popup">
      <h2>Thanks for your visit.</h2>

      <div>
	You aren't interesting in contributing. I get that, everyone has
	moments where it just doesn't work. Thanks for visiting.
      </div>

      <div>
	Please watch this ad for 15 seconds and
	then you'll have full access to the post.
      </div>

      <div>
	While you wait:
	<a target="_new" href="https://admin.teddyhyde.com">
	  <h3 class="underline">Why not create your own blog here?</h3>
	</a>
	Create your <strong>FREE Jekyll blog</strong> hosted on GitHub:
	<strong>fast and secure over HTTPS</strong>,
	with <strong>PWA notifications</strong> so your users never miss a post,
	and collect <strong>cryptocurrency micro-contributions</strong> with ease.
    </div>

  </div>
</div>
</div>
</div>
</body>
</html>